{"ast":null,"code":"var _jsxFileName = \"D:\\\\kHAIITDEVERLOPER\\\\iot\\\\traffic\\\\frontend-react\\\\src\\\\App.jsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\n// frontend-react/src/App.jsx\nimport React, { useState, useEffect } from \"react\";\nimport { BrowserRouter as Router, Routes, Route, Navigate, useLocation } from \"react-router-dom\";\nimport io from \"socket.io-client\";\nimport Login from \"./components/Login\";\nimport Dashboard from \"./components/Dashboard\";\nimport History from \"./components/History\";\n\n// Kết nối socket 1 lần duy nhất\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst socket = io(\"http://localhost:5000\", {\n  reconnection: true,\n  reconnectionAttempts: 5,\n  reconnectionDelay: 1000\n});\n\n// Component bảo vệ route (chỉ admin mới vào được History)\nfunction ProtectedRoute({\n  children,\n  requiredRole = \"admin\"\n}) {\n  _s();\n  const role = localStorage.getItem(\"role\");\n  const location = useLocation();\n  if (!role) {\n    return /*#__PURE__*/_jsxDEV(Navigate, {\n      to: \"/login\",\n      replace: true\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 28,\n      columnNumber: 12\n    }, this);\n  }\n  if (requiredRole && role !== requiredRole) {\n    return /*#__PURE__*/_jsxDEV(Navigate, {\n      to: \"/\",\n      replace: true\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 32,\n      columnNumber: 12\n    }, this);\n  }\n  return children;\n}\n\n// Loading screen đẹp khi đang kết nối\n_s(ProtectedRoute, \"pkHmaVRPskBaU4tMJuJJpV42k1I=\", false, function () {\n  return [useLocation];\n});\n_c = ProtectedRoute;\nfunction LoadingScreen() {\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      minHeight: \"100vh\",\n      background: \"linear-gradient(135deg, #0f2027, #203a43)\",\n      display: \"grid\",\n      placeItems: \"center\",\n      color: \"#00e5ff\",\n      fontSize: \"28px\",\n      fontWeight: \"bold\"\n    },\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        children: \"\\u0110ang t\\u1EA3i h\\u1EC7 th\\u1ED1ng ANPR...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 51,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          fontSize: \"18px\",\n          marginTop: \"20px\",\n          color: \"#81d4fa\"\n        },\n        children: \"Vui l\\xF2ng ch\\u1EDD trong gi\\xE2y l\\xE1t\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 52,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 50,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 41,\n    columnNumber: 5\n  }, this);\n}\n_c2 = LoadingScreen;\nfunction App() {\n  _s2();\n  const [role, setRole] = useState(null);\n  const [isLoading, setIsLoading] = useState(true);\n  useEffect(() => {\n    // Kiểm tra đã login chưa\n    const savedRole = localStorage.getItem(\"role\");\n    if (savedRole) {\n      setRole(savedRole);\n    }\n    setIsLoading(false);\n  }, []);\n  const handleLogin = newRole => {\n    setRole(newRole);\n    localStorage.setItem(\"role\", newRole);\n    // Đổi URL về trang chủ ngay lập tức\n    window.location.href = \"/\";\n  };\n  const handleLogout = () => {\n    localStorage.clear();\n    setRole(null);\n    window.location.href = \"/login\";\n  };\n\n  // Hiển thị loading lúc đầu\n  if (isLoading) {\n    return /*#__PURE__*/_jsxDEV(LoadingScreen, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 12\n    }, this);\n  }\n\n  // Nếu chưa login → vào trang login\n  if (!role) {\n    return /*#__PURE__*/_jsxDEV(Login, {\n      onLogin: handleLogin\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 12\n    }, this);\n  }\n\n  // Đã login → vào hệ thống\n  return /*#__PURE__*/_jsxDEV(Router, {\n    children: /*#__PURE__*/_jsxDEV(Routes, {\n      children: [/*#__PURE__*/_jsxDEV(Route, {\n        path: \"/\",\n        element: /*#__PURE__*/_jsxDEV(Dashboard, {\n          role: role,\n          socket: socket,\n          onLogout: handleLogout\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 103,\n          columnNumber: 20\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 101,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Route, {\n        path: \"/history\",\n        element: /*#__PURE__*/_jsxDEV(ProtectedRoute, {\n          requiredRole: \"admin\",\n          children: /*#__PURE__*/_jsxDEV(History, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 109,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 108,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 105,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Route, {\n        path: \"/login\",\n        element: /*#__PURE__*/_jsxDEV(Navigate, {\n          to: \"/\",\n          replace: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 113,\n          columnNumber: 39\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 113,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Route, {\n        path: \"*\",\n        element: /*#__PURE__*/_jsxDEV(Navigate, {\n          to: \"/\",\n          replace: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 114,\n          columnNumber: 34\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 114,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 98,\n    columnNumber: 5\n  }, this);\n}\n_s2(App, \"q6pvGX90ilmtIxXc9aRyned3yrs=\");\n_c3 = App;\nexport default App;\nvar _c, _c2, _c3;\n$RefreshReg$(_c, \"ProtectedRoute\");\n$RefreshReg$(_c2, \"LoadingScreen\");\n$RefreshReg$(_c3, \"App\");","map":{"version":3,"names":["React","useState","useEffect","BrowserRouter","Router","Routes","Route","Navigate","useLocation","io","Login","Dashboard","History","jsxDEV","_jsxDEV","socket","reconnection","reconnectionAttempts","reconnectionDelay","ProtectedRoute","children","requiredRole","_s","role","localStorage","getItem","location","to","replace","fileName","_jsxFileName","lineNumber","columnNumber","_c","LoadingScreen","style","minHeight","background","display","placeItems","color","fontSize","fontWeight","marginTop","_c2","App","_s2","setRole","isLoading","setIsLoading","savedRole","handleLogin","newRole","setItem","window","href","handleLogout","clear","onLogin","path","element","onLogout","_c3","$RefreshReg$"],"sources":["D:/kHAIITDEVERLOPER/iot/traffic/frontend-react/src/App.jsx"],"sourcesContent":["// frontend-react/src/App.jsx\r\nimport React, { useState, useEffect } from \"react\";\r\nimport {\r\n  BrowserRouter as Router,\r\n  Routes,\r\n  Route,\r\n  Navigate,\r\n  useLocation\r\n} from \"react-router-dom\";\r\nimport io from \"socket.io-client\";\r\nimport Login from \"./components/Login\";\r\nimport Dashboard from \"./components/Dashboard\";\r\nimport History from \"./components/History\";\r\n\r\n// Kết nối socket 1 lần duy nhất\r\nconst socket = io(\"http://localhost:5000\", {\r\n  reconnection: true,\r\n  reconnectionAttempts: 5,\r\n  reconnectionDelay: 1000\r\n});\r\n\r\n// Component bảo vệ route (chỉ admin mới vào được History)\r\nfunction ProtectedRoute({ children, requiredRole = \"admin\" }) {\r\n  const role = localStorage.getItem(\"role\");\r\n  const location = useLocation();\r\n\r\n  if (!role) {\r\n    return <Navigate to=\"/login\" replace />;\r\n  }\r\n\r\n  if (requiredRole && role !== requiredRole) {\r\n    return <Navigate to=\"/\" replace />;\r\n  }\r\n\r\n  return children;\r\n}\r\n\r\n// Loading screen đẹp khi đang kết nối\r\nfunction LoadingScreen() {\r\n  return (\r\n    <div style={{\r\n      minHeight: \"100vh\",\r\n      background: \"linear-gradient(135deg, #0f2027, #203a43)\",\r\n      display: \"grid\",\r\n      placeItems: \"center\",\r\n      color: \"#00e5ff\",\r\n      fontSize: \"28px\",\r\n      fontWeight: \"bold\"\r\n    }}>\r\n      <div>\r\n        <div>Đang tải hệ thống ANPR...</div>\r\n        <div style={{ fontSize: \"18px\", marginTop: \"20px\", color: \"#81d4fa\" }}>\r\n          Vui lòng chờ trong giây lát\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction App() {\r\n  const [role, setRole] = useState(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    // Kiểm tra đã login chưa\r\n    const savedRole = localStorage.getItem(\"role\");\r\n    if (savedRole) {\r\n      setRole(savedRole);\r\n    }\r\n    setIsLoading(false);\r\n  }, []);\r\n\r\n  const handleLogin = (newRole) => {\r\n    setRole(newRole);\r\n    localStorage.setItem(\"role\", newRole);\r\n    // Đổi URL về trang chủ ngay lập tức\r\n    window.location.href = \"/\";\r\n  };\r\n\r\n  const handleLogout = () => {\r\n    localStorage.clear();\r\n    setRole(null);\r\n    window.location.href = \"/login\";\r\n  };\r\n\r\n  // Hiển thị loading lúc đầu\r\n  if (isLoading) {\r\n    return <LoadingScreen />;\r\n  }\r\n\r\n  // Nếu chưa login → vào trang login\r\n  if (!role) {\r\n    return <Login onLogin={handleLogin} />;\r\n  }\r\n\r\n  // Đã login → vào hệ thống\r\n  return (\r\n    <Router>\r\n      {/* Truyền socket và logout function xuống Dashboard */}\r\n      <Routes>\r\n        <Route\r\n          path=\"/\"\r\n          element={<Dashboard role={role} socket={socket} onLogout={handleLogout} />}\r\n        />\r\n        <Route\r\n          path=\"/history\"\r\n          element={\r\n            <ProtectedRoute requiredRole=\"admin\">\r\n              <History />\r\n            </ProtectedRoute>\r\n          }\r\n        />\r\n        <Route path=\"/login\" element={<Navigate to=\"/\" replace />} />\r\n        <Route path=\"*\" element={<Navigate to=\"/\" replace />} />\r\n      </Routes>\r\n    </Router>\r\n  );\r\n}\r\n\r\nexport default App;"],"mappings":";;;AAAA;AACA,OAAOA,KAAK,IAAIC,QAAQ,EAAEC,SAAS,QAAQ,OAAO;AAClD,SACEC,aAAa,IAAIC,MAAM,EACvBC,MAAM,EACNC,KAAK,EACLC,QAAQ,EACRC,WAAW,QACN,kBAAkB;AACzB,OAAOC,EAAE,MAAM,kBAAkB;AACjC,OAAOC,KAAK,MAAM,oBAAoB;AACtC,OAAOC,SAAS,MAAM,wBAAwB;AAC9C,OAAOC,OAAO,MAAM,sBAAsB;;AAE1C;AAAA,SAAAC,MAAA,IAAAC,OAAA;AACA,MAAMC,MAAM,GAAGN,EAAE,CAAC,uBAAuB,EAAE;EACzCO,YAAY,EAAE,IAAI;EAClBC,oBAAoB,EAAE,CAAC;EACvBC,iBAAiB,EAAE;AACrB,CAAC,CAAC;;AAEF;AACA,SAASC,cAAcA,CAAC;EAAEC,QAAQ;EAAEC,YAAY,GAAG;AAAQ,CAAC,EAAE;EAAAC,EAAA;EAC5D,MAAMC,IAAI,GAAGC,YAAY,CAACC,OAAO,CAAC,MAAM,CAAC;EACzC,MAAMC,QAAQ,GAAGlB,WAAW,CAAC,CAAC;EAE9B,IAAI,CAACe,IAAI,EAAE;IACT,oBAAOT,OAAA,CAACP,QAAQ;MAACoB,EAAE,EAAC,QAAQ;MAACC,OAAO;IAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAE,CAAC;EACzC;EAEA,IAAIX,YAAY,IAAIE,IAAI,KAAKF,YAAY,EAAE;IACzC,oBAAOP,OAAA,CAACP,QAAQ;MAACoB,EAAE,EAAC,GAAG;MAACC,OAAO;IAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAE,CAAC;EACpC;EAEA,OAAOZ,QAAQ;AACjB;;AAEA;AAAAE,EAAA,CAfSH,cAAc;EAAA,QAEJX,WAAW;AAAA;AAAAyB,EAAA,GAFrBd,cAAc;AAgBvB,SAASe,aAAaA,CAAA,EAAG;EACvB,oBACEpB,OAAA;IAAKqB,KAAK,EAAE;MACVC,SAAS,EAAE,OAAO;MAClBC,UAAU,EAAE,2CAA2C;MACvDC,OAAO,EAAE,MAAM;MACfC,UAAU,EAAE,QAAQ;MACpBC,KAAK,EAAE,SAAS;MAChBC,QAAQ,EAAE,MAAM;MAChBC,UAAU,EAAE;IACd,CAAE;IAAAtB,QAAA,eACAN,OAAA;MAAAM,QAAA,gBACEN,OAAA;QAAAM,QAAA,EAAK;MAAyB;QAAAS,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAK,CAAC,eACpClB,OAAA;QAAKqB,KAAK,EAAE;UAAEM,QAAQ,EAAE,MAAM;UAAEE,SAAS,EAAE,MAAM;UAAEH,KAAK,EAAE;QAAU,CAAE;QAAApB,QAAA,EAAC;MAEvE;QAAAS,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAK,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACH;EAAC;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACH,CAAC;AAEV;AAACY,GAAA,GAnBQV,aAAa;AAqBtB,SAASW,GAAGA,CAAA,EAAG;EAAAC,GAAA;EACb,MAAM,CAACvB,IAAI,EAAEwB,OAAO,CAAC,GAAG9C,QAAQ,CAAC,IAAI,CAAC;EACtC,MAAM,CAAC+C,SAAS,EAAEC,YAAY,CAAC,GAAGhD,QAAQ,CAAC,IAAI,CAAC;EAEhDC,SAAS,CAAC,MAAM;IACd;IACA,MAAMgD,SAAS,GAAG1B,YAAY,CAACC,OAAO,CAAC,MAAM,CAAC;IAC9C,IAAIyB,SAAS,EAAE;MACbH,OAAO,CAACG,SAAS,CAAC;IACpB;IACAD,YAAY,CAAC,KAAK,CAAC;EACrB,CAAC,EAAE,EAAE,CAAC;EAEN,MAAME,WAAW,GAAIC,OAAO,IAAK;IAC/BL,OAAO,CAACK,OAAO,CAAC;IAChB5B,YAAY,CAAC6B,OAAO,CAAC,MAAM,EAAED,OAAO,CAAC;IACrC;IACAE,MAAM,CAAC5B,QAAQ,CAAC6B,IAAI,GAAG,GAAG;EAC5B,CAAC;EAED,MAAMC,YAAY,GAAGA,CAAA,KAAM;IACzBhC,YAAY,CAACiC,KAAK,CAAC,CAAC;IACpBV,OAAO,CAAC,IAAI,CAAC;IACbO,MAAM,CAAC5B,QAAQ,CAAC6B,IAAI,GAAG,QAAQ;EACjC,CAAC;;EAED;EACA,IAAIP,SAAS,EAAE;IACb,oBAAOlC,OAAA,CAACoB,aAAa;MAAAL,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAE,CAAC;EAC1B;;EAEA;EACA,IAAI,CAACT,IAAI,EAAE;IACT,oBAAOT,OAAA,CAACJ,KAAK;MAACgD,OAAO,EAAEP;IAAY;MAAAtB,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAE,CAAC;EACxC;;EAEA;EACA,oBACElB,OAAA,CAACV,MAAM;IAAAgB,QAAA,eAELN,OAAA,CAACT,MAAM;MAAAe,QAAA,gBACLN,OAAA,CAACR,KAAK;QACJqD,IAAI,EAAC,GAAG;QACRC,OAAO,eAAE9C,OAAA,CAACH,SAAS;UAACY,IAAI,EAAEA,IAAK;UAACR,MAAM,EAAEA,MAAO;UAAC8C,QAAQ,EAAEL;QAAa;UAAA3B,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAE;MAAE;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAC5E,CAAC,eACFlB,OAAA,CAACR,KAAK;QACJqD,IAAI,EAAC,UAAU;QACfC,OAAO,eACL9C,OAAA,CAACK,cAAc;UAACE,YAAY,EAAC,OAAO;UAAAD,QAAA,eAClCN,OAAA,CAACF,OAAO;YAAAiB,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAE;QAAC;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACG;MACjB;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACF,CAAC,eACFlB,OAAA,CAACR,KAAK;QAACqD,IAAI,EAAC,QAAQ;QAACC,OAAO,eAAE9C,OAAA,CAACP,QAAQ;UAACoB,EAAE,EAAC,GAAG;UAACC,OAAO;QAAA;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAE;MAAE;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAE,CAAC,eAC7DlB,OAAA,CAACR,KAAK;QAACqD,IAAI,EAAC,GAAG;QAACC,OAAO,eAAE9C,OAAA,CAACP,QAAQ;UAACoB,EAAE,EAAC,GAAG;UAACC,OAAO;QAAA;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAE;MAAE;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAE,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAClD;EAAC;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACH,CAAC;AAEb;AAACc,GAAA,CA1DQD,GAAG;AAAAiB,GAAA,GAAHjB,GAAG;AA4DZ,eAAeA,GAAG;AAAC,IAAAZ,EAAA,EAAAW,GAAA,EAAAkB,GAAA;AAAAC,YAAA,CAAA9B,EAAA;AAAA8B,YAAA,CAAAnB,GAAA;AAAAmB,YAAA,CAAAD,GAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}