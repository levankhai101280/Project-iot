{"ast":null,"code":"import React,{useEffect,useState,useCallback}from\"react\";import io from\"socket.io-client\";import\"./App.css\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const socket=io(\"http://localhost:5000\");export default function App(){const[frame,setFrame]=useState(null);const[counts,setCounts]=useState({});const[updatedKeys,setUpdatedKeys]=useState([]);const[confThreshold,setConfThreshold]=useState(0.3);const[isIntrusionAlert,setIsIntrusionAlert]=useState(false);const[plates,setPlates]=useState({});// Gửi ngưỡng tin cậy lên server\nconst sendThresholdUpdate=useCallback(newThreshold=>{socket.emit(\"update_conf_threshold\",{threshold:newThreshold});},[]);const handleThresholdChange=event=>{const newThreshold=parseFloat(event.target.value);setConfThreshold(newThreshold);sendThresholdUpdate(newThreshold);};useEffect(()=>{socket.on(\"frame\",data=>{setFrame(\"data:image/jpeg;base64,\"+data.frame);// Cập nhật tổng số đối tượng\nconst changedKeys=Object.keys(data.counts).filter(key=>counts[key]!==data.counts[key]);setUpdatedKeys(changedKeys);setCounts(data.counts);// Cập nhật cảnh báo xâm nhập & biển số\nif(data.intrusion!==undefined)setIsIntrusionAlert(data.intrusion);if(data.plates)setPlates(data.plates);setTimeout(()=>setUpdatedKeys([]),800);});sendThresholdUpdate(confThreshold);return()=>{socket.off(\"frame\");};},[counts,confThreshold,sendThresholdUpdate,plates]);return/*#__PURE__*/_jsxs(\"div\",{className:\"app-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:isIntrusionAlert?\"alert-active\":\"\",children:/*#__PURE__*/_jsx(\"h1\",{children:\"H\\u1EC7 Th\\u1ED1ng Theo D\\xF5i Ng\\u01B0\\u1EDDi \\u0110i B\\u1ED9 v\\xE0 Ph\\u01B0\\u01A1ng Ti\\u1EC7n\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"content\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"stream-container\",children:frame?/*#__PURE__*/_jsx(\"img\",{src:frame,alt:\"stream\",className:isIntrusionAlert?\"stream-alert-border\":\"\"}):/*#__PURE__*/_jsx(\"p\",{className:\"waiting-text\",children:\"\\u0110ang ch\\u1EDD d\\u1EEF li\\u1EC7u video...\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"counts-container\",children:[isIntrusionAlert&&/*#__PURE__*/_jsx(\"div\",{className:\"intrusion-banner\",children:\"C\\u1EA2NH B\\xC1O X\\xC2M NH\\u1EACP V\\xD9NG C\\u1EA4M!\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"control-panel\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"B\\u1EA3ng \\u0110i\\u1EC1u Khi\\u1EC3n\"}),/*#__PURE__*/_jsxs(\"label\",{children:[\"Ng\\u01B0\\u1EE1ng \\u0111\\u1ED9 tin c\\u1EADy: \",confThreshold.toFixed(2)]}),/*#__PURE__*/_jsx(\"input\",{type:\"range\",min:\"0.05\",max:\"0.95\",step:\"0.05\",value:confThreshold,onChange:handleThresholdChange,className:\"threshold-slider\"})]}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsx(\"h2\",{children:\"Bi\\u1EC3n S\\u1ED1 \\u0110\\xE3 Nh\\u1EADn Di\\u1EC7n\"}),Object.keys(plates).length>0?/*#__PURE__*/_jsx(\"ul\",{className:\"plate-list\",children:Object.entries(plates).map(_ref=>{let[id,plate]=_ref;return/*#__PURE__*/_jsxs(\"li\",{children:[\"ID \",id.replace(\"LP_\",\"\"),\":\",\" \",/*#__PURE__*/_jsx(\"span\",{className:\"plate-text\",children:plate})]},id);})}):/*#__PURE__*/_jsx(\"p\",{children:\"Ch\\u01B0a ph\\xE1t hi\\u1EC7n bi\\u1EC3n s\\u1ED1.\"}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsx(\"h2\",{children:\"T\\u1ED5ng S\\u1ED1 \\u0110\\u1ED1i T\\u01B0\\u1EE3ng\"}),/*#__PURE__*/_jsx(\"ul\",{children:Object.entries(counts).map(_ref2=>{let[k,v]=_ref2;return/*#__PURE__*/_jsxs(\"li\",{className:updatedKeys.includes(k)?\"count-updated\":\"\",children:[k,\": \",/*#__PURE__*/_jsx(\"span\",{children:v})]},k);})})]})]})]});}","map":{"version":3,"names":["React","useEffect","useState","useCallback","io","jsx","_jsx","jsxs","_jsxs","socket","App","frame","setFrame","counts","setCounts","updatedKeys","setUpdatedKeys","confThreshold","setConfThreshold","isIntrusionAlert","setIsIntrusionAlert","plates","setPlates","sendThresholdUpdate","newThreshold","emit","threshold","handleThresholdChange","event","parseFloat","target","value","on","data","changedKeys","Object","keys","filter","key","intrusion","undefined","setTimeout","off","className","children","src","alt","toFixed","type","min","max","step","onChange","length","entries","map","_ref","id","plate","replace","_ref2","k","v","includes"],"sources":["D:/kHAIITDEVERLOPER/iot/traffic/frontend-react/src/App.jsx"],"sourcesContent":["import React, { useEffect, useState, useCallback } from \"react\";\r\nimport io from \"socket.io-client\";\r\nimport \"./App.css\";\r\n\r\nconst socket = io(\"http://localhost:5000\");\r\n\r\nexport default function App() {\r\n  const [frame, setFrame] = useState(null);\r\n  const [counts, setCounts] = useState({});\r\n  const [updatedKeys, setUpdatedKeys] = useState([]);\r\n  const [confThreshold, setConfThreshold] = useState(0.3);\r\n  const [isIntrusionAlert, setIsIntrusionAlert] = useState(false);\r\n  const [plates, setPlates] = useState({});\r\n\r\n  // Gửi ngưỡng tin cậy lên server\r\n  const sendThresholdUpdate = useCallback((newThreshold) => {\r\n    socket.emit(\"update_conf_threshold\", { threshold: newThreshold });\r\n  }, []);\r\n\r\n  const handleThresholdChange = (event) => {\r\n    const newThreshold = parseFloat(event.target.value);\r\n    setConfThreshold(newThreshold);\r\n    sendThresholdUpdate(newThreshold);\r\n  };\r\n\r\n  useEffect(() => {\r\n    socket.on(\"frame\", (data) => {\r\n      setFrame(\"data:image/jpeg;base64,\" + data.frame);\r\n\r\n      // Cập nhật tổng số đối tượng\r\n      const changedKeys = Object.keys(data.counts).filter(\r\n        (key) => counts[key] !== data.counts[key]\r\n      );\r\n      setUpdatedKeys(changedKeys);\r\n      setCounts(data.counts);\r\n\r\n      // Cập nhật cảnh báo xâm nhập & biển số\r\n      if (data.intrusion !== undefined) setIsIntrusionAlert(data.intrusion);\r\n      if (data.plates) setPlates(data.plates);\r\n\r\n      setTimeout(() => setUpdatedKeys([]), 800);\r\n      \r\n    });\r\n\r\n    sendThresholdUpdate(confThreshold);\r\n\r\n    return () => {\r\n      socket.off(\"frame\");\r\n    };\r\n  }, [counts, confThreshold, sendThresholdUpdate, plates]);\r\n\r\n  return (\r\n    <div className=\"app-container\">\r\n      <div className={isIntrusionAlert ? \"alert-active\" : \"\"}>\r\n        <h1>Hệ Thống Theo Dõi Người Đi Bộ và Phương Tiện</h1>\r\n      </div>\r\n\r\n      <div className=\"content\">\r\n        <div className=\"stream-container\">\r\n          {frame ? (\r\n            <img\r\n              src={frame}\r\n              alt=\"stream\"\r\n              className={isIntrusionAlert ? \"stream-alert-border\" : \"\"}\r\n            />\r\n          ) : (\r\n            <p className=\"waiting-text\">Đang chờ dữ liệu video...</p>\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"counts-container\">\r\n          {/* CẢNH BÁO XÂM NHẬP */}\r\n          {isIntrusionAlert && (\r\n            <div className=\"intrusion-banner\">\r\n              CẢNH BÁO XÂM NHẬP VÙNG CẤM!\r\n            </div>\r\n          )}\r\n\r\n          {/* BẢNG ĐIỀU KHIỂN */}\r\n          <div className=\"control-panel\">\r\n            <h2>Bảng Điều Khiển</h2>\r\n            <label>Ngưỡng độ tin cậy: {confThreshold.toFixed(2)}</label>\r\n            <input\r\n              type=\"range\"\r\n              min=\"0.05\"\r\n              max=\"0.95\"\r\n              step=\"0.05\"\r\n              value={confThreshold}\r\n              onChange={handleThresholdChange}\r\n              className=\"threshold-slider\"\r\n            />\r\n          </div>\r\n\r\n          <hr />\r\n\r\n          {/* BIỂN SỐ ĐÃ NHẬN DIỆN */}\r\n          <h2>Biển Số Đã Nhận Diện</h2>\r\n          {Object.keys(plates).length > 0 ? (\r\n            <ul className=\"plate-list\">\r\n              {Object.entries(plates).map(([id, plate]) => (\r\n                <li key={id}>\r\n                  ID {id.replace(\"LP_\", \"\")}:{\" \"}\r\n                  <span className=\"plate-text\">{plate}</span>\r\n                </li>\r\n              ))}\r\n            </ul>\r\n          ) : (\r\n            <p>Chưa phát hiện biển số.</p>\r\n          )}\r\n\r\n          <hr />\r\n\r\n          {/* TỔNG SỐ ĐỐI TƯỢNG */}\r\n          <h2>Tổng Số Đối Tượng</h2>\r\n          <ul>\r\n            {Object.entries(counts).map(([k, v]) => (\r\n              <li\r\n                key={k}\r\n                className={updatedKeys.includes(k) ? \"count-updated\" : \"\"}\r\n              >\r\n                {k}: <span>{v}</span>\r\n              </li>\r\n            ))}\r\n          </ul>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}